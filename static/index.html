<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LangGraph Chat</title>
  <style>
    body { font-family: Arial; margin: 0; padding: 0; background: #f4f4f4; }
    #chat-container { padding: 20px; max-width: 800px; margin: auto; }
    .human, .api { margin: 10px 0; padding: 10px; border-radius: 5px; }
    .human { background-color: #dff0d8; text-align: right; }
    .api { background-color: #d9edf7; text-align: left; }
    textarea { width: 100%; font-family: monospace; margin-top: 10px; }
    button { margin-top: 10px; padding: 10px 20px; }
  </style>
</head>
<body>
  <div id="chat-container"></div>

  <script>
    const socket = new WebSocket("ws://localhost:8000/ws");

    socket.onmessage = (event) => {
      const msg = JSON.parse(event.data);
      if (msg.type === "payload_confirmation") {
        renderPayloadConfirmation(msg);
      } else if (msg.type === "api_response") {
        addChatMessage("api", JSON.stringify(msg.result, null, 2));
      } else if (msg.type === "text") {
        addChatMessage("api", msg.text || msg.message || JSON.stringify(msg));
      }
    };

    function renderPayloadConfirmation(msg) {
      addChatMessage("api", msg.prompt || "Please confirm the payload:");

      const container = document.getElementById("chat-container");

      const textarea = document.createElement("textarea");
      textarea.id = "payload-editor";
      textarea.rows = 10;
      textarea.value = JSON.stringify(msg.payload, null, 2);
      container.appendChild(textarea);

      const confirmButton = document.createElement("button");
      confirmButton.textContent = "✅ Confirm Payload";
      confirmButton.onclick = () => {
        try {
          const editedPayload = JSON.parse(textarea.value);
          socket.send(JSON.stringify({
            type: "user_payload_confirmation",
            payload: editedPayload
          }));
          addChatMessage("human", "✅ Payload confirmed");
        } catch (e) {
          alert("Invalid JSON. Please fix it before confirming.");
        }
      };
      container.appendChild(confirmButton);
    }

    function addChatMessage(sender, message) {
      const container = document.getElementById("chat-container");
      const msgDiv = document.createElement("div");
      msgDiv.className = sender;
      msgDiv.textContent = message;
      container
